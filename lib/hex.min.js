/*!
 * hexlib JavaScript Library v0.1
 * http://hexlib.com
 *
 * Copyright 2010, Jim R. Wilson
 * Licensed under the MIT license.
 * http://hexlib.com/license
 *
 * Date: Sun Jun 20 22:11:20 2010 -0400
 */
(function(s,t){(function(c,m,i){function a(){}function g(d){for(var n=0,k=arguments.length;n<k;n++){var b=arguments[n];if(b)for(var l in b)if(f.call(b,l))d[l]=b[l]}return d}m=c.hex={version:"0.1"};var h=Array.prototype.join,e=Array.prototype.slice,f=Object.prototype.hasOwnProperty;m.extend=g;g(m,{create:function(d){if(!d)throw"no parent supplied";var n=e.call(arguments,1);a.prototype=d;var k=new a;if(!n.length)return k;n.unshift(k);return g.apply(i,n)},key:function(){return h.call(arguments,",")},
log:function(){this.debug&&c.console&&console.log.apply(console,arguments)}})})(s,s.document);(function(c){c.extend(c,{position:function(m){var i=m.offsetLeft,a=m.offsetTop;for(m=m.offsetParent;m;){i+=m.offsetLeft;a+=m.offsetTop;m=m.offsetParent}return{x:i,y:a}},size:function(m){return{x:m.offsetWidth,y:m.offsetHeight}},style:function(m,i){var a;if(m.currentStyle)a=m.currentStyle[i];else if(s.getComputedStyle)a=t.defaultView.getComputedStyle(m,null).getPropertyValue(i);return a}})})(s.hex);(function(c,
m){var i=Array.prototype.slice,a={};c.extend(c,{evented:{addEvent:function(e,f){if(!this.events)this.events={};var d=this.events[e];if(d===m)d=this.events[e]=[];d[d.length]=f;return this},trigger:function(e){if(!this.events||!this.events[e])return false;for(var f=10,d=this.events[e],n=i.call(arguments,0),k=0,b=d.length,l=false,p=n[0]=c.create(a,{type:e,preventDefault:function(){l=true}}),r=[];k<b;)try{for(;k<b;)d[k++].apply(this,n)}catch(u){r[r.length]=u;setTimeout(function(){throw u;},f++)}return{event:p,
errors:r,prevented:l,args:n}},queue:function(){var e=this.eventqueue;if(!e)e=this.eventqueue=[];e[e.length]=i.call(arguments,0)},fire:function(){var e=this.eventqueue;if(e&&e.length)for(;e.length;)this.trigger.apply(this,e.shift())}}});var g={getTarget:function(){var e=this.target||this.srcElement;if(!e)return m;return e.nodeType===3?e.parentNode:e},inside:function(e){var f=this.mousepos(),d=c.position(e);e=c.size(e);return f.x>d.x&&f.x<d.x+e.x&&f.y>d.y&&f.y<d.y+e.y},mousepos:function(e){var f,d=
0;f=0;if(this.touches&&this.touches.length){f=this.touches[0];d=f.pageX;f=f.pageY}else if(this.changedTouches&&this.changedTouches.length){f=this.changedTouches[0];d=f.pageX;f=f.pageY}else if(this.pageX!==m&&this.pageY!==m){d=this.pageX;f=this.pageY}else if(this.clientX!==m&&this.clientY!==m){d=this.clientX+t.body.scrollLeft+t.documentElement.scrollLeft;f=this.clientY+t.body.scrollTop+t.documentElement.scrollTop}if(e){e=c.position(e);d-=e.x;f-=e.y}return{x:d,y:f}},preventDefault:function(){var e=
this.event;if(e.preventDefault)e.preventDefault();else e.returnValue=false},stopPropagation:function(){var e=this.event;if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true}},h;if(t.addEventListener){h={remove:function(){return this.elem.removeEventListener(this.type,this.callback)}};c.extend(c,{addEvent:function(e,f,d){function n(k){return d.call(e,c.create(k,g,{event:k}))}e.addEventListener(f,n,false);return c.create(h,{callback:n,elem:e,handler:d,type:f})},removeEvent:function(e,f,
d){e.removeEventListener(f,d,false)}})}else if(t.attachEvent){h={remove:function(){return this.elem.detachEvent("on"+this.type,this.callback)}};c.extend(c,{addEvent:function(e,f,d){function n(){var b=s.event;return d.call(e,c.extend({},b,g,{event:b}))}function k(){e.detachEvent("on"+f,n);s.detachEvent("onunload",k)}e.attachEvent("on"+f,n);s.attachEvent("onunload",k);return c.create(h,{callback:n,elem:e,handler:d,type:f})},removeEvent:function(e,f,d){e.detachEvent("on"+f,d)}})}})(s.hex);(function(c,
m){var i=c.create(c.evented,{defaults:{type:"hexagonal",tapthreshold:400},reorient:function(a,g){this.origin.x=+a;this.origin.y=+g;this.root.style.left=a+"px";this.root.style.top=g+"px";this.elem.style.backgroundPosition=a+"px "+g+"px"}});c.extend(c,{grid:function(a,g){function h(j){var q=j.inside(a),o=j.mousepos(a);j={x:o.x-b.origin.x,y:o.y-b.origin.y};if(p.panning){if(p.enabled&&q){q=j.x-p.x;j=j.y-p.y;k.style.left=q+"px";k.style.top=j+"px";a.style.backgroundPosition=q+"px "+j+"px";b.trigger("panmove",
o.x-p.x-2*b.origin.x,o.y-p.y-2*b.origin.y)}}else{o=b.events.tileover;var v=b.events.tileout,w=b.events.gridover,x=b.events.gridout;if(!(!o&&!v&&!w&&!x)){j=b.translate(j.x,j.y);if(!(q&&l.x===j.x&&l.y===j.y)){v&&l.x!==null&&l.y!==null&&b.queue("tileout",l.x,l.y);!q&&x&&l.x!==null&&l.y!==null&&b.queue("gridout",l.x,l.y);if(q){w&&l.x===null&&l.y===null&&b.queue("gridover",j.x,j.y);o&&b.queue("tileover",j.x,j.y);l.x=j.x;l.y=j.y}else{l.x=null;l.y=null}b.fire()}}}}function e(j){if(j.inside(a)){var q=j.type,
o=j.mousepos(a);if(q==="mouseup"||q==="mousedown")j.preventDefault();if(q==="touchstart")if(!j.touches||j.touches.length<2)j.preventDefault();if(!p.panning&&(q==="mousedown"||q==="touchstart"||q==="MozTouchDown")){p.panning=true;p.x=o.x-2*b.origin.x;p.y=o.y-2*b.origin.y;a.style.cursor="move";b.queue("panstart")}if(p.panning&&(q==="mouseup"||q==="touchend"||q==="MozTouchUp"||q==="MozTouchRelease")){j=o.x-2*b.origin.x-p.x;var v=o.y-2*b.origin.y-p.y;if((j<0?-j:j)>b.tileWidth||(v<0?-v:v)>b.tileHeight)u=
null;if(p.enabled){b.queue("panend",o.x-p.x-2*b.origin.x,o.y-p.y-2*b.origin.y);b.reorient(o.x-b.origin.x-p.x,o.y-b.origin.y-p.y)}p.enabled=true;p.panning=false;p.x=null;p.y=null;a.style.cursor=""}j=b.events.tiledown;v=b.events.tileup;var w=b.events.tileclick,x=b.events.tiletap;if(!(!j&&!v&&!w&&!x)){o={x:o.x-b.origin.x,y:o.y-b.origin.y};o=b.translate(o.x,o.y);if(q==="mousedown"||q==="touchstart"||q==="MozTouchDown"){u=+new Date;if(j){b.fire();if((q=b.trigger("tiledown",o.x,o.y))&&q.prevented)p.enabled=
false}r.x=o.x;r.y=o.y}else if(q==="mouseup"||q==="touchend"||q==="MozTouchUp"||q==="MozTouchRelease"){v&&b.queue("tileup",o.x,o.y);if(r.x===o.x&&r.y===o.y){w&&b.queue("tileclick",o.x,o.y);x&&u&&+new Date-u<b.tapthreshold&&b.queue("tiletap",o.x,o.y)}r.x=null;u=r.y=null}}b.fire()}}function f(j){if(p.panning){b.reorient(parseInt(k.style.left,10),parseInt(k.style.top,10));p.panning=false;p.x=null;p.y=null;a.style.cursor="";r.x!==null&&r.y!==null&&!j.inside(a)&&b.queue("gridout",r.x,r.y);r.x=null;r.y=
null;l.x=null;u=l.y=null;b.fire()}}function d(j){if(!j.ctrlKey){var q=j.inside(a),o=j.detail?j.detail*-1:j.wheelDelta*0.025;o=o>0?1:o<0?-1:0;if(q&&o){j.preventDefault();if(j.wheelDeltaX||j.axis&&j.axis===j.HORIZONTAL_AXIS){j=b.tileWidth*o;b.queue("panstart");b.queue("panmove",j,0);b.queue("panend",j,0);b.reorient(b.origin.x+j,b.origin.y)}else{j=b.tileHeight*o;b.queue("panstart");b.queue("panmove",0,j);b.queue("panend",0,j);b.reorient(b.origin.x,b.origin.y+j)}}}}if(!a||a.nodeType!==1)throw"no DOM element supplied";
g=c.extend({},i.defaults,g);if(c.grid[g.type]===m)throw"hex.grid."+g.type+" does not exist";var n=c.style(a,"position");if(n!=="relative"&&n!=="absolute")a.style.position="relative";if(c.style(a,"overflow")!=="hidden")a.style.overflow="hidden";var k=t.createElement("div");k.style.position="absolute";k.style.left="0px";k.style.top="0px";k.style.overflow="visible";a.appendChild(k);var b=c.create(i,{events:{},origin:{x:0,y:0}},c.grid[g.type],g,{elem:a,root:k}),l={x:null,y:null},p={enabled:true,panning:false,
x:null,y:null};c.addEvent(a,"mousemove",h);c.addEvent(a,"mouseover",h);c.addEvent(a,"mouseout",h);c.addEvent(a,"touchmove",h);c.addEvent(a,"touchstart",h);c.addEvent(a,"touchend",h);c.addEvent(a,"MozTouchDown",h);c.addEvent(a,"MozTouchMove",h);c.addEvent(a,"MozTouchUp",h);c.addEvent(a,"MozTouchRelease",h);var r={x:null,y:null},u=null;c.addEvent(a,"mousedown",e);c.addEvent(a,"mouseup",e);c.addEvent(a,"touchstart",e);c.addEvent(a,"touchend",e);c.addEvent(a,"MozTouchDown",h);c.addEvent(a,"MozTouchUp",
h);c.addEvent(a,"MozTouchRelease",h);c.addEvent(t,"mouseup",f);c.addEvent(t,"touchend",f);c.addEvent(t,"gesturestart",f);c.addEvent(t,"gesturechange",f);c.addEvent(t,"gestureend",f);c.addEvent(t,"MozTouchUp",f);c.addEvent(t,"MozTouchRelease",f);c.addEvent(a,"mousewheel",d);c.addEvent(a,"DOMMouseScroll",d);b.init&&b.init();return b}})})(s.hex);(function(c){var m=Math.floor;c.grid.hexagonal={quadrant:function(i,a){var g=this.tileWidth,h=this.tileHeight;g=m((i-g*0.25)/(g*0.75));h=m(a/h);return{x:g,y:h}},
screenpos:function(i,a){var g=this.tileHeight;return{x:i*this.tileWidth*0.75,y:-a*g-i*g*0.5}},tileHeight:42,tileWidth:48,translate:function(i,a){var g=this.tileWidth*0.5,h=g*0.5,e=h*3,f=this.tileHeight,d=f*0.5,n=d/h,k,b=this.quadrant(i,a);k=b.x;b=b.y;h=(i-h)%e;var l=a%f;if(h<0)h+=e;if(l<0)l+=f;h-=g;if(k%2){g=k;k=(1-k)*0.5-b-(l>d?1:0);if(h<=0||l==d)return{x:g,y:k};if(l<d&&l>d-h*n)return{x:g+1,y:k-1};if(l>d&&l<d+h*n)return{x:g+1,y:k}}else{g=k;k=-k*0.5-b;if(h<=0||l==d)return{x:g,y:k};if(l<d&&l<h*n)return{x:g+
1,y:k};if(l>d&&l>f-h*n)return{x:g+1,y:k-1}}return{x:g,y:k}}}})(s.hex);(function(c){var m=Math.ceil,i=Math.floor;c.grid.rectangular={screenpos:function(a,g){return{x:a*this.tileWidth,y:-g*this.tileHeight}},tileHeight:48,tileWidth:48,translate:function(a,g){return{x:i(a/this.tileWidth),y:m(-g/this.tileHeight)}}}})(s.hex);(function(c){var m=Math.floor;c.grid.skew={e1:{x:21,y:-36},e2:{x:-21,y:-36},init:function(){var i=this.e1.x,a=this.e1.y,g=this.e2.x,h=this.e2.y;if(i*h===g*a)throw"incomputable coefficient";
this.coefficient=1/(i*h-g*a);i=[i,i+g,g];a=[a,a+h,h];for(var e=g=h=0,f=0,d=0;d<3;d++){if(i[d]>h)h=i[d];if(i[d]<g)g=i[d];if(a[d]>e)e=a[d];if(a[d]<f)f=a[d]}this.tileWidth=h-g;this.tileHeight=e-f;this.offset={x:-g,y:-f}},screenpos:function(i,a){return{x:i*this.e1.x+a*this.e2.x,y:i*this.e1.y+a*this.e2.y}},translate:function(i,a){var g=this.coefficient;i-=this.offset.x;a-=this.offset.y;return{x:m(g*(i*this.e2.y-a*this.e2.x)),y:m(g*(a*this.e1.x-i*this.e1.y))}}}})(s.hex);(function(c){var m=Math.floor;c.grid.triangular=
{tileHeight:48,tileWidth:56,init:function(){var i=this.tileHeight,a=this.tileWidth;this.e1={x:a,y:0};this.e2={x:a*0.5,y:-i};c.grid.skew.init.call(this);this.tileHeight=i;this.tileWidth=a},screenpos:function(i,a){return c.grid.skew.screenpos.call(this,i*0.5,a)},translate:function(i,a){i-=this.offset.x;a-=this.offset.y;var g=this.coefficient,h=g*(i*this.e2.y-a*this.e2.x);g=g*(a*this.e1.x-i*this.e1.y);var e=m(h),f=m(g);return{x:e*2+(h+g-e-f>1?1:0),y:f}}}})(s.hex);(function(c){var m=c.create(c.evented);
c.extend(c,{region:function(i,a){if(!i)throw"no grid was supplied";a=c.extend({},a);if(typeof a.inside!=="function")throw"options.inside is not a function";var g=c.create(m,a,{grid:i}),h=false;i.addEvent("tileover",function(f,d,n){f=g.inside(d,n);if(f!==h)g.trigger(f?"regionover":"regionout",d,n);h=f});i.addEvent("gridout",function(f,d,n){h&&g.trigger("regionout",d,n);h=false});var e=false;i.addEvent("tiledown",function(f,d,n){(f=g.inside(d,n))&&g.trigger("regiondown",d,n);e=f});i.addEvent("tileup",
function(f,d,n){if(g.inside(d,n)){g.trigger("regionup",d,n);e&&g.trigger("regionclick",d,n)}});return g}})})(s.hex);(function(c,m){var i={},a={defaults:{delay:100,repeat:false},animate:function(h){h=c.extend({},a.defaults,h);var e=this.elem,f=this.coords,d=f[0],n=f[2],k=this.sprite.spritemap.width,b=h.repeat,l=0,p;p=this.timeout=s.setInterval(function(){l++;if(l>=n)if(b)l=0;else{s.clearTimeout(p);return}e.style.left=-(d+l)*k+"px"},h.delay)},stop:function(){s.clearTimeout(this.timeout)}},g={defaults:{},
sprite:function(){var h=c.create(i,{spritemap:this}),e=h.base=t.createElement("div");e.className="sprite";c.extend(e.style,{position:"relative",overflow:"hidden",width:this.width+"px",height:this.height+"px"});for(var f=h.layers=[],d=0,n=arguments.length;d<n;d++){var k=arguments[d],b=this.map[k],l=b[0],p=b[1],r=t.createElement("div");f[d]=c.create(a,{type:k,elem:r,sprite:h,coords:b});c.extend(r.style,{position:"absolute",width:this.mapwidth+"px",height:this.mapheight+"px",top:-p*this.height+"px",
left:-l*this.width+"px",backgroundImage:"url('"+this.url+"')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.url+"', sizingMethod='crop')"});e.appendChild(r)}return h}};c.extend(c,{spritemap:function(h){if(h===m)throw"no options hash was supplied";h=c.extend({},g.defaults,h);var e=h.map,f=0,d=0;for(var n in e){var k=e[n];if(k[0]>f)f=k[0];if(k[1]>d)d=k[1]}return c.create(g,{mapwidth:(f+1)*h.width,mapheight:(d+1)*h.height},h)}})})(s.hex)})(window,window.document);
